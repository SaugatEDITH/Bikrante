<section class="products section--lg">
  <div class="container">
    {% if search_text %}
      <h2 class="section__title">Search Results for "{{ search_text }}"</h2>
      {% if total_results %}
        <p class="total__products">Found <span>{{ total_results }}</span> products</p>
      {% endif %}
    {% endif %}
    
    <!-- Debug info -->
    {% comment %} {% if debug %}
    <div class="search-debug-info" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px;">
      <p>Search text: "{{ search_text }}"</p>
      <p>Results found: {{ total_results|default:"0" }}</p>
      <p>Current page: {{ current_page }}</p>
      <p>Template used: {{ template_name }}</p>
    </div>
    {% endif %} {% endcomment %}

    <div class="products__container grid">
      {% if products %}
        {% for product in products %}
          <div class="product__item">
            <div class="product__banner">
              <a href="{% url 'product-detail' product.slug %}" class="product__images">
                <img src="{{ product.image1.url }}" alt="{{ product.name }}" class="product__img default" />
                {% if product.image2 %}
                <img src="{{ product.image2.url }}" alt="{{ product.name }}" class="product__img hover" />
                {% endif %}
              </a>
              {% if product.is_hot %}
                <div class="product__badge {{ product.class_color|default:'light-blue' }}">Hot</div>
              {% endif %}
            </div>
            <div class="product__content">
              <span class="product__category">{{ product.category.name }}</span>
              <a href="{% url 'product-detail' product.slug %}">
                <h3 class="product__title">{{ product.name }}</h3>
              </a>
              <div class="product__price flex">
                <span class="new__price">रु{{ product.price }}</span>
                {% if product.old_price %}
                <span class="old__price">रु{{ product.old_price }}</span>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="no-results">
          {% if search_text %}
            <p>No products found matching "{{ search_text }}"</p>
          {% else %}
            <p>Enter a search term to find products</p>
          {% endif %}
        </div>
      {% endif %}
    </div>

    {% if products.has_other_pages %}
      <div class="pagination">
        {% if products.has_previous %}
          <a class="pagination__link" 
             hx-get="{% url 'search' %}?search_text={{ search_text }}&page={{ products.previous_page_number }}"
             hx-target="#search-results">
            <i class="fas fa-chevron-left"></i>
          </a>
        {% endif %}

        {% for num in page_range %}
          <a class="pagination__link {% if num == current_page %}active{% endif %}"
             hx-get="{% url 'search' %}?search_text={{ search_text }}&page={{ num }}"
             hx-target="#search-results">
            {{ num }}
          </a>
        {% endfor %}

        {% if products.has_next %}
          <a class="pagination__link" 
             hx-get="{% url 'search' %}?search_text={{ search_text }}&page={{ products.next_page_number }}"
             hx-target="#search-results">
            <i class="fas fa-chevron-right"></i>
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>
